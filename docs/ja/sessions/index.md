# 会話コンテキスト入門：セッション、状態、メモリ

<div class="language-support-tag">
    <span class="lst-supported">ADKでサポート</span><span class="lst-python">Python</span><span class="lst-typescript">TypeScript</span><span class="lst-go">Go</span><span class="lst-java">Java</span>
</div>

意味のある、複数ターンにわたる会話を実現するには、エージェントがコンテキストを理解する必要があります。人間と同様に、エージェントは継続性を保ち、繰り返しを避けるために、会話の履歴、つまりこれまで何を話し、何が行われたかを思い出す必要があります。エージェント開発キット（ADK）は、`Session`、`State`、`Memory`を通じてこのコンテキストを管理するための構造化された方法を提供します。

## コアコンセプト

エージェントとの会話のさまざまなインスタンスを、**長期的な知識**を利用する可能性のある、個別の**会話スレッド**として考えてみてください。

1.  **`Session`**: 現在の会話スレッド

    *   ユーザーとエージェントシステム間の*単一の、進行中のインタラクション*を表します。
    *   *その特定のインタラクション*中にエージェントによって行われたメッセージとアクションの時系列シーケンス（`イベント`と呼ばれる）を含みます。
    *   また、`Session`は*この会話中*にのみ関連する一時的なデータ（`State`）を保持することもできます。

2.  **`State` (`session.state`)**: 現在の会話内のデータ

    *   特定の`Session`内に保存されるデータです。
    *   （例：*このチャット中*のショッピングカート内のアイテム、*このセッションで*言及されたユーザー設定など）*現在アクティブな*会話スレッドにのみ関連する情報を管理するために使用されます。

3.  **`Memory`**: 検索可能な、セッション横断的な情報

    *   *複数の過去のセッション*にまたがる、または外部データソースを含む可能性のある情報ストアを表します。
    *   エージェントが当面の会話を超えて情報やコンテキストを思い出すために*検索*できるナレッジベースとして機能します。

## コンテキストの管理：サービス

ADKは、これらの概念を管理するためのサービスを提供します：

1.  **`SessionService`**: さまざまな会話スレッド（`Session`オブジェクト）を管理します。

    *   ライフサイクルを処理します：個々の`Session`の作成、取得、更新（`イベント`の追加、`State`の変更）、削除。

2.  **`MemoryService`**: 長期的な知識ストア（`Memory`）を管理します。

    *   （多くの場合、完了した`Session`からの）情報を長期ストアに取り込むことを処理します。
    *   クエリに基づいてこの保存された知識を検索するメソッドを提供します。

**実装**: ADKは`SessionService`と`MemoryService`の両方に対してさまざまな実装を提供しており、アプリケーションのニーズに最も適したストレージバックエンドを選択できます。特筆すべきは、両方のサービスに**インメモリ実装**が提供されていることです。これらは特に**ローカルテストと迅速な開発**のために設計されています。**これらのインメモリオプションを使用して保存されたすべてのデータ（セッション、状態、または長期的な知識）は、アプリケーションが再起動すると失われる**ことを覚えておくことが重要です。ローカルテストを超えた永続性とスケーラビリティのために、ADKはクラウドベースおよびデータベースサービスのオプションも提供しています。

**まとめ：**

*   **`Session` & `State`**: **現在のインタラクション**に焦点 – *単一のアクティブな会話*の履歴とデータ。主に`SessionService`によって管理されます。
*   **Memory**: **過去および外部の情報**に焦点 – 複数の会話にまたがる可能性のある*検索可能なアーカイブ*。`MemoryService`によって管理されます。

## 次のステップ

次のセクションでは、これらの各コンポーネントについてさらに詳しく掘り下げていきます：

*   **`Session`**: その構造と`イベント`を理解する。
*   **`State`**: セッション固有のデータを効果的に読み書きし、管理する方法。
*   **`SessionService`**: セッションに適したストレージバックエンドを選択する。
*   **`MemoryService`**: より広範なコンテキストを保存および取得するためのオプションを探る。

これらの概念を理解することは、複雑でステートフル、かつコンテキストを認識する会話に参加できるエージェントを構築するための基本です。
