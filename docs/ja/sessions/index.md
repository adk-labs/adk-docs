# 会話のコンテキスト入門：セッション、状態、メモリ

## なぜコンテキストが重要なのか

意味のある、複数ターンにわたる会話には、エージェントがコンテキストを理解することが必要です。人間と同じように、継続性を保ち、繰り返しを避けるためには、これまでに何が話され、何が行われたかという会話の履歴を思い出す必要があります。Agent Development Kit (ADK) は、`セッション`、`状態`、`メモリ`を通じてこのコンテキストを管理するための構造化された方法を提供します。

## コアコンセプト

エージェントとの会話のさまざまなインスタンスを、個別の**会話スレッド**と考え、それらが**長期的な知識**を利用する可能性があると想像してください。

1.  **`セッション (Session)`**: 現在の会話スレッド

    *   ユーザーとエージェントシステム間の*単一の、進行中の対話*を表します。
    *   *その特定の対話*中にエージェントによって取られたメッセージとアクションの時系列シーケンス（`イベント (Events)`と呼ばれる）を含みます。
    *   `セッション`は、*この会話中*にのみ関連する一時的なデータ（`状態 (State)`）を保持することもできます。

2.  **`状態 (State)` (`session.state`)**: 現在の会話内のデータ

    *   特定の`セッション`内に保存されるデータ。
    *   *現在のアクティブな*会話スレッドに*のみ*関連する情報を管理するために使用されます（例：*このチャット中*のショッピングカート内のアイテム、*このセッションで*言及されたユーザー設定）。

3.  **`メモリ (Memory)`**: 検索可能で、セッションをまたぐ情報

    *   *複数の過去のセッション*にまたがる可能性のある情報、または外部データソースを含む情報のストアを表します。
    *   エージェントが、目の前の会話を超えて情報やコンテキストを思い出すために*検索*できる知識ベースとして機能します。

## コンテキストの管理：サービス

ADKは、これらの概念を管理するためのサービスを提供します：

1.  **`SessionService`**: さまざまな会話スレッド（`Session`オブジェクト）を管理します。

    *   ライフサイクルを処理します：個々の`セッション`の作成、取得、更新（`イベント`の追加、`状態`の変更）、および削除。

2.  **`MemoryService`**: 長期的な知識ストア（`メモリ`）を管理します。

    *   （多くの場合、完了した`セッション`から）長期的なストアに情報を取り込む処理をします。
    *   クエリに基づいてこの保存された知識を検索するメソッドを提供します。

**実装**: ADKは`SessionService`と`MemoryService`の両方に対してさまざまな実装を提供しており、アプリケーションのニーズに最も適したストレージバックエンドを選択できます。特筆すべきは、両方のサービスに対して**インメモリ実装**が提供されていることです。これらは**ローカルでのテストや迅速な開発**のために特別に設計されています。これらのインメモリオプションを使用して保存されたすべてのデータ（セッション、状態、または長期的な知識）は、**アプリケーションが再起動すると失われる**ことを覚えておくことが重要です。ローカルテストを超えた永続性とスケーラビリティのために、ADKはクラウドベースおよびデータベースサービスのオプションも提供しています。

**まとめ：**

*   **`セッション`と`状態`**: **現在の対話**に焦点を当てます – *単一のアクティブな会話*の履歴とデータ。主に`SessionService`によって管理されます。
*   **メモリ**: **過去および外部の情報**に焦点を当てます – 会話をまたぐ可能性のある*検索可能なアーカイブ*。`MemoryService`によって管理されます。

## 次のステップ

以下のセクションでは、これらの各コンポーネントについてさらに詳しく掘り下げていきます：

*   **`セッション`**: その構造と`イベント`を理解する。
*   **`状態`**: セッション固有のデータを効果的に読み書きし、管理する方法。
*   **`SessionService`**: セッションに適したストレージバックエンドを選択する。
*   **`MemoryService`**: より広範なコンテキストを保存および取得するためのオプションを探る。

これらの概念を理解することは、複雑でステートフル、かつコンテキストを意識した会話ができるエージェントを構築するための基本です。